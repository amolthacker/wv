purge: false
priority: 1
desc: Group deployment of DPS-1.2.1 (DLM-1.3, DSS-1.3, and DAS-1.2) with 1 CDA-3.1, 1 Datalake-3.1 and 1 Ephemeral cluster
seq:
- open_port: [-1, 1, 65534, '192.175.27.2/32']  # Hwx VPN
- open_port: [tcp, 5432, 5432, '0.0.0.0/0']
- open_port: [tcp, 33389, 33389, '0.0.0.0/0']
- open_port: [tcp, 8443, 8443, '0.0.0.0/0']
- replace_str: [inf-dps121, deploy.sh, ADMINPASSWORD]
- replace_str: [inf-dps121, blueprint.json, ADMINPASSWORD]
- prep_deps: [inf-dps121, dps121]
- prep_spec: [inf-dps121, dps121]
- do_builds: [dps121]
- write_cache: [dps121, public_ip, DPSPUBLICIP]
- write_cache: [dps121, public_ip, RDSPUBLICIP]
- write_cache: [dps121, public_ip, LDAPPUBLICIP]
- write_cache: [dps121, 5432, RDSPORT]
- replace_str: [inf-datalake31-multi, pre-ambari-configs.sh, DPSPUBLICIP]
- replace_str: [inf-cda31-multi, pre-ambari-configs.sh, DPSPUBLICIP]
- replace_str: [inf-datalake31-multi, pre-ambari-configs.sh, ADMINPASSWORD]
- replace_str: [inf-cda31-multi, pre-ambari-configs.sh, ADMINPASSWORD]
- replace_str: [inf-cda31-multi, blueprint.json, LDAPPUBLICIP]
- replace_str: [inf-datalake31-multi, blueprint.json, LDAPPUBLICIP]
- prep_deps: [inf-datalake31-multi, datalake31]
- prep_spec: [inf-datalake31-multi, datalake31]
- wait_event: [inf-dps121, dps121, cluster_status, AVAILABLE]
- do_builds: [datalake31]
- write_cache: [datalake31, public_ip, SHAREDSERVICESPUBLICIP]
- write_cache: [datalake31, private_ip, SHAREDSERVICESPRIVATEIP]
- write_cache: [datalake31, shared_services, SHAREDSERVICESNAME]
- replace_str: [inf-ephemeral31-multi, pre-ambari-configs.sh, DPSPUBLICIP]
- replace_str: [inf-ephemeral31-multi, pre-ambari-configs.sh, ADMINPASSWORD]
- replace_str: [inf-ephemeral31-multi, blueprint.json, LDAPPUBLICIP]
- prep_deps: [inf-ephemeral31-multi, ephemeral-31-m]
- prep_spec: [inf-ephemeral31-multi, ephemeral-31-m]
- prep_deps: [inf-cda31-multi, cda-31-x]
- prep_spec: [inf-cda31-multi, cda-31-x]
- do_builds: [cda-31-x]
- wait_event: [inf-datalake31-multi, datalake31, cluster_status, AVAILABLE]
- do_builds: [ephemeral-31-m]